{"name":"Ravi Bhat's Wisdom","tagline":"","body":"## Who am I?\r\n\r\n* Educated in _the_ full-stack: microchips, hardware, web: back-end, front-end, UI/UX.\r\n* **Web Architect**\r\n* **Front-end** (my preferred zone)\r\n* Back-end (forays)\r\n* Microchips/Hardware (hobby)\r\n* Wantrapreneur, in a good way :)\r\n* Technical debt collector.\r\n\r\n___\r\n# (post-in-progress) A pattern for server-side interaction via AngularJS using the client-side patterns previously mentioned below\r\n\r\nSet up $ctrl in params object for REST server call:\r\n\r\n\tvar $ctrl = params.$ctrl;\r\n\tif (!$ctrl) {\r\n\t\ttry {\r\n\t\t\t$ctrl = { ngModel: params };\r\n\t\t\t$ctrl = $controller(\r\n\t\t\t\t\"FilterCtrl\",\r\n\t\t\t\t{ $scope: angular.extend($rootScope.$new(true), { $ctrl: $ctrl }) }\r\n\t\t\t);\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t\t$ctrl = null;\r\n\t\t}\r\n\t}\r\n\tvar custom = $ctrl && $ctrl.customString();\r\n\tif (custom) {\r\n\t\tnewParams.custom = custom;\r\n\t}\r\n\r\n___\r\n# (Nov 2015) Final working inheritance pattern using Angular 1.4\r\n* Makes further use of the '$' prefixed variable hiding\r\n* Angular's $controller service is used to instantiate a controller\r\n* Controller instance reference is in $ctrl\r\n* wrapObject() to force setting a subInstance property to instead set the parent's property (like an ES6 Proxy setter, but in ES5)\r\n* subController() does the magic\r\n* Note: ngModel interface used to follow the common model paradigm\r\n\r\nmyExtend service:\r\n\r\n\t// instance extensions\r\n\tangular.factory('myExtend', ['$controller', function($controller) {\r\n\t\treturn {\r\n\t\t\twrapObject: function(obj) {\r\n\r\n\t\t\t\t// wrap with setters to the prototype\r\n\t\t\t\tvar props = {};\r\n\r\n\t\t\t\tfor(var key in obj) {\r\n\r\n\t\t\t\t\tif (typeof obj[key] != \"function\") {\r\n\t\t\t\t\t\tprops[key] = {\r\n\r\n\t\t\t\t\t\t\t\"get\": (function (key) {\r\n\r\n\t\t\t\t\t\t\t\treturn function () {\r\n\r\n\t\t\t\t\t\t\t\t\treturn obj[key];\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t})(key),\r\n\r\n\t\t\t\t\t\t\t\"set\": (function (key) {\r\n\r\n\t\t\t\t\t\t\t\treturn function (val) {\r\n\r\n\t\t\t\t\t\t\t\t\tobj[key] = val;\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t})(key)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Object.create(obj, props);\r\n\t\t\t},\r\n\r\n\t\t\tsubController: function($scope, name) {\r\n\r\n\t\t\t\tvar model = $scope.$ctrl.ngModel;\r\n\t\t\t\tvar baseCtrl = model.$ctrl;\r\n\t\t\t\tvar subCtrl = baseCtrl;\r\n\r\n\t\t\t\tif (baseCtrl) {\r\n\t\t\t\t\tsubCtrl = this.wrapObject(baseCtrl);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (name) {\r\n\t\t\t\t\t\tsubCtrl = $controller(name, {$scope: $scope});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tsubCtrl = $scope.$ctrl;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmodel.$ctrl = subCtrl;\r\n\r\n\t\t\t\t$scope.$on('$destroy', function() {\r\n\t\t\t\t\tif (baseCtrl) {\r\n\t\t\t\t\t\tmodel.$ctrl = baseCtrl;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tdelete model.$ctrl;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn subCtrl;\r\n\t\t\t},\r\n\r\n\t\t\tcomponent: {\r\n\r\n\t\t\t\tsetModels: function () {\r\n\r\n\t\t\t\t\tif ('modelDef' in this) {\r\n\r\n\t\t\t\t\t\t// set up models based on definitions\r\n\t\t\t\t\t\tthis.model = this.model || {};\r\n\r\n\t\t\t\t\t\tfor (var defKey in this.modelDef) {\r\n\r\n\t\t\t\t\t\t\tvar def = this.modelDef[defKey];\r\n\t\t\t\t\t\t\tvar model;\r\n\r\n\t\t\t\t\t\t\tif (def.list) {\r\n\t\t\t\t\t\t\t\tmodel = [];\r\n\t\t\t\t\t\t\t\tif ('sortBy' in def) {\r\n\t\t\t\t\t\t\t\t\tmodel.$sort = def.sortBy;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (def.list.paged) {\r\n\t\t\t\t\t\t\t\t\tmodel.$offset = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tmodel = {};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.model[defKey] = model;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ('filterDef' in this) {\r\n\r\n\t\t\t\t\t\tthis.filter = this.filter || {};\r\n\t\t\t\t\t\tthis.filter.$def = this.filterDef;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}]);\r\n\r\nmyFilter directive+controller, with FilterCtrl base controller:\r\n\r\n\tangular.module('my.directives.filter', ['my.directives.dateFilter', 'my.directives.listFilter'])\r\n\t\r\n\t\t.directive('myFilter', function() {\r\n\t\r\n\t\t\treturn {\r\n\t\t\t\trequire: ['ngModel'],\r\n\t\t\t\trestrict: 'E',\r\n\t\t\t\tscope: {},\r\n\t\t\t\ttemplateUrl: '/directives/filter.html',\r\n\t\t\t\tcontrollerAs: '$ctrl',\r\n\t\t\t\tbindToController: {\r\n\t\t\t\t\tngModel: '='\r\n\t\t\t\t},\r\n\t\r\n\t\t\t\tcontroller: ['$scope', '$controller', 'myExtend', function($scope, $controller, myExtend) {\r\n\t\r\n\t\t\t\t\tvar model = $scope.$ctrl.ngModel;\r\n\t\t\t\t\tvar ctrl = myExtend.subController($scope, 'FilterCtrl');\r\n\t\t\t\t\tvar $def = model.$def;\r\n\t\r\n\t\t\t\t\tangular.extend(ctrl, {\r\n\t\r\n\t\t\t\t\t\tcomponents: {},\r\n\t\r\n\t\t\t\t\t\tdisplayString: function (defKey) {\r\n\t\r\n\t\t\t\t\t\t\tvar def = $def.options[defKey];\r\n\t\t\t\t\t\t\tif (defKey in ctrl.components) {\r\n\t\t\t\t\t\t\t\treturn (def.label + ': ' + ctrl.components[defKey].displayString());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn (def.label + ': ' + model[defKey]);\r\n\t\t\t\t\t\t},\r\n\t\r\n\t\t\t\t\t\taddFilterComponent: function (name, componentCtrl) {\r\n\t\r\n\t\t\t\t\t\t\tctrl.components[name] = componentCtrl;\r\n\t\t\t\t\t\t},\r\n\t\r\n\t\t\t\t\t\tdefaultOrEmpty: function (defKey) {\r\n\t\r\n\t\t\t\t\t\t\tvar def = $def.options[defKey];\r\n\t\r\n\t\t\t\t\t\t\tif (def.type == 'text') {\r\n\t\t\t\t\t\t\t\treturn (model[defKey] == '');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (defKey in ctrl.components) {\r\n\t\r\n\t\t\t\t\t\t\t\treturn ctrl.components[defKey].defaultOrEmpty();\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t},\r\n\t\r\n\t\t\t\t\t\thasFilters: function () {\r\n\t\r\n\t\t\t\t\t\t\tfor (var defKey in $def.options) {\r\n\t\r\n\t\t\t\t\t\t\t\tif (!ctrl.defaultOrEmpty(defKey)) {\r\n\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t},\r\n\t\r\n\t\t\t\t\t\tresetFilter: function (defKey) {\r\n\t\r\n\t\t\t\t\t\t\tvar def = $def.options[defKey];\r\n\t\r\n\t\t\t\t\t\t\tif (def.type == 'text') {\r\n\t\t\t\t\t\t\t\tmodel[defKey] = '';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tctrl.components[defKey].reset();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tresetFilters: function () {\r\n\t\r\n\t\t\t\t\t\t\tfor (var defKey in $def.options) {\r\n\t\r\n\t\t\t\t\t\t\t\tctrl.resetFilter(defKey);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\r\n\t\t\t\t\treturn ctrl;\r\n\t\t\t\t}]\r\n\t\t\t}\r\n\t\t})\r\n\t\r\n\t\t.controller('FilterCtrl', ['$rootScope', '$scope', '$controller', 'myExtend', function($rootScope, $scope, $controller, myExtend) {\r\n\t\r\n\t\t\tvar model = $scope.$ctrl.ngModel;\r\n\t\t\tvar ctrl = myExtend.subController($scope);\r\n\t\t\tvar $def = model.$def;\r\n\t\r\n\t\t\tangular.extend(ctrl, {\r\n\t\r\n\t\t\t\tcustomString: function() {\r\n\t\t\t\t\tvar paramDef = $def && $def.options;\r\n\t\t\t\t\tif (!paramDef) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tvar customArr = [];\r\n\t\t\t\t\tfor (var defKey in model) {\r\n\t\r\n\t\t\t\t\t\tif (!model.hasOwnProperty(defKey) || (defKey[0] == '$') || (model[defKey] == null)) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\tif (defKey in paramDef) {\r\n\t\t\t\t\t\t\tif (paramDef[defKey].type == 'text') {\r\n\t\r\n\t\t\t\t\t\t\t\tif (model[defKey] != '') {\r\n\t\t\t\t\t\t\t\t\tcustomArr.push(\"custom string\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tvar customStr = model[defKey].$ctrl.customString();\r\n\t\t\t\t\t\t\t\tif (customStr) {\r\n\t\t\t\t\t\t\t\t\tcustomArr.push(customStr);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn customArr.join(\",\"); // separator\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tif (!$def) {\r\n\t\t\t\treturn ctrl;\r\n\t\t\t}\r\n\t\r\n\t\t\tfor (var defKey in $def.options) {\r\n\t\r\n\t\t\t\tvar def = $def.options[defKey];\r\n\t\r\n\t\t\t\tif (!(defKey in model)) {\r\n\t\r\n\t\t\t\t\tswitch(def.type) {\r\n\t\r\n\t\t\t\t\t\tcase 'text':\r\n\t\t\t\t\t\t\tmodel[defKey] = '';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\r\n\t\t\t\t\t\tcase 'ListFilterCtrl':\r\n\t\t\t\t\t\t\tmodel[defKey] = [];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tmodel[defKey] = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif (def.type != 'text') {\r\n\t\r\n\t\t\t\t\tvar filterValue = model[defKey];\r\n\t\t\t\t\tif ('$def' in def) {\r\n\t\t\t\t\t\tfilterValue.$def = def.$def;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar $ctrl = filterValue.$ctrl;\r\n\t\t\t\t\tif (!$ctrl) {\r\n\t\t\t\t\t\t$ctrl = { name: defKey, ngModel: filterValue };\r\n\t\t\t\t\t\t$controller(\r\n\t\t\t\t\t\t\tdef.type,\r\n\t\t\t\t\t\t\t{$scope: angular.extend($rootScope.$new(true), {$ctrl: $ctrl})}\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\treturn ctrl;\r\n\t\t}]);\r\n\r\nmyListFilter directive+controller, and ListFilterCtrl base controller:\r\n\r\n\tangular.module('my.directives.listFilter', [])\r\n\t\r\n\t\t.directive('myListFilter', function() {\r\n\t\r\n\t\t\treturn {\r\n\t\t\t\trequire: ['^myFilter', 'ngModel'],\r\n\t\t\t\trestrict: 'E',\r\n\t\t\t\tscope: {},\r\n\t\t\t\ttemplateUrl: '/directives/listFilter.html',\r\n\t\t\t\tcontrollerAs: '$ctrl',\r\n\t\t\t\tbindToController: {\r\n\t\t\t\t\tname: '=',\r\n\t\t\t\t\tngModel: '='\r\n\t\t\t\t},\r\n\t\r\n\t\t\t\tcontroller: ['$scope', 'myExtend', '$filter', function($scope, myExtend, $filter) {\r\n\t\r\n\t\t\t\t\tvar model = $scope.$ctrl.ngModel;\r\n\t\t\t\t\tvar ctrl = myExtend.subController($scope, 'ListFilterCtrl');\r\n\t\r\n\t\t\t\t\tif (!('$def' in model)) { // set up defaults (for testing only)\r\n\t\r\n\t\t\t\t\t\tmodel.$def = {};\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tvar $def = model.$def;\r\n\t\r\n\t\t\t\t\tif (!('options' in $def)) { // set up defaults (for testing only)\r\n\t\r\n\t\t\t\t\t\t$def.options = {\r\n\t\t\t\t\t\t\t\"\": { index: 0, label: \"(test)\" }\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tvar modelMap = ctrl.modelMap;\r\n\t\r\n\t\t\t\t\tangular.extend(ctrl, {\r\n\t\r\n\t\t\t\t\t\tdefaultOrEmpty: function () {\r\n\t\r\n\t\t\t\t\t\t\tif (ctrl.isEmpty()) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\tvar defaultKey = $filter('myOrderObjectBy')($def.options, 'index')[0]._key;\r\n\t\r\n\t\t\t\t\t\t\tfor (var key in modelMap) {\r\n\t\t\t\t\t\t\t\tif ((key != defaultKey) && modelMap[key]) {\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t},\r\n\t\r\n\t\t\t\t\t\tdisplayString: function() {\r\n\t\r\n\t\t\t\t\t\t\tvar strArr = [];\r\n\t\r\n\t\t\t\t\t\t\tctrl.forEach(function(key) {\r\n\t\r\n\t\t\t\t\t\t\t\tstrArr.push($def.options[key].label);\r\n\t\t\t\t\t\t\t});\r\n\t\r\n\t\t\t\t\t\t\treturn strArr.join(', ');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}],\r\n\t\r\n\t\t\t\tlink: function ($scope, $element, $attrs, ctrls) {\r\n\t\r\n\t\t\t\t\tvar ctrl = $scope.$ctrl = $scope.$ctrl.ngModel.$ctrl;\r\n\t\r\n\t\t\t\t\tvar filterCtrl = ctrls[0];\r\n\t\t\t\t\tfilterCtrl.addFilterComponent(ctrl.name, ctrl);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\r\n\t\t.controller('ListFilterCtrl', ['$scope', '$filter', 'myExtend', function($scope, $filter, myExtend) {\r\n\t\r\n\t\t\tvar model = $scope.$ctrl.ngModel;\r\n\t\t\tvar ctrl = myExtend.subController($scope);\r\n\t\r\n\t\t\tvar $def = model.$def;\r\n\t\r\n\t\t\tvar modelMap = {};\r\n\t\r\n\t\t\tangular.extend(ctrl, {\r\n\t\r\n\t\t\t\tmodelMap: modelMap,\r\n\t\r\n\t\t\t\tisEmpty: function () {\r\n\t\r\n\t\t\t\t\tfor (var key in modelMap) {\r\n\t\t\t\t\t\tif (modelMap[key]) {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t},\r\n\t\r\n\t\t\t\tclear: function() {\r\n\t\r\n\t\t\t\t\tif (!$def || !$def.options) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tfor (var key in $def.options) {\r\n\t\r\n\t\t\t\t\t\tmodelMap[key] = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\r\n\t\t\t\treset: function () {\r\n\t\r\n\t\t\t\t\tctrl.clear();\r\n\t\r\n\t\t\t\t\tif (!$def || !$def.options) {\r\n\t\t\t\t\t\tmodelMap[''] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvar defaultKey = $filter('myOrderObjectBy')($def.options, 'index')[0]._key;\r\n\t\t\t\t\t\tmodelMap[defaultKey] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\r\n\t\t\t\tcustomString: function() {\r\n\t\r\n\t\t\t\t\tif (ctrl.isEmpty()) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tvar customArr = [];\r\n\t\r\n\t\t\t\t\tctrl.forEach(function(key) {\r\n\t\r\n\t\t\t\t\t\tcustomArr.push(\"custom string\");\r\n\t\t\t\t\t});\r\n\t\r\n\t\t\t\t\treturn customArr.join(\",\"); // separator\r\n\t\t\t\t},\r\n\t\r\n\t\t\t\tforEach: function(handler) {\r\n\t\r\n\t\t\t\t\tif (ctrl.isEmpty()) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tvar optionsArr = $filter('myOrderObjectBy')($def.options, 'index');\r\n\t\r\n\t\t\t\t\tfor (var i=0, len=optionsArr.length; i<len; i++) {\r\n\t\r\n\t\t\t\t\t\tvar key = optionsArr[i]._key;\r\n\t\r\n\t\t\t\t\t\tif (key == '') {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\tif (modelMap[key]) {\r\n\t\t\t\t\t\t\thandler(key);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\r\n\t\t\t\tvalueString: function() {\r\n\t\r\n\t\t\t\t\tif (ctrl.isEmpty()) {\r\n\t\t\t\t\t\treturn \"\";\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tvar strArr = [];\r\n\t\r\n\t\t\t\t\tctrl.forEach(function(key) {\r\n\t\r\n\t\t\t\t\t\tstrArr.push(key);\r\n\t\t\t\t\t});\r\n\t\r\n\t\t\t\t\treturn strArr.join(',');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\t$scope.$watchCollection(\"$ctrl.ngModel\", function() {\r\n\t\r\n\t\t\t\tctrl.clear();\r\n\t\r\n\t\t\t\tmodel.forEach(function(key) {\r\n\t\r\n\t\t\t\t\tmodelMap[key] = true;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\r\n\t\t\t$scope.$watchCollection(\"$ctrl.modelMap\", function() {\r\n\t\r\n\t\t\t\tmodel.length = 0;\r\n\t\r\n\t\t\t\tctrl.forEach(function(key) {\r\n\t\r\n\t\t\t\t\tmodel.push(key);\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\tif (!$def) {\r\n\t\t\t\t\tif (model.length == 0) {\r\n\t\t\t\t\t\tmodel.push('');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t\tif (model.length == 0) {\r\n\t\t\t\tctrl.reset(); // set default value\r\n\t\t\t}\r\n\t\r\n\t\t\treturn ctrl;\r\n\t\t}]);\r\n\r\nmyDateFilter directive+controller, and DateFilterCtrl controller:\r\n\r\n\tvar labels = {\r\n\t\t'before': 'Before This Date',\r\n\t\t'after': 'After This Date',\r\n\t\t'on': 'On This Date',\r\n\t\t'custom': 'Custom Range'\r\n\t};\r\n\r\n\tvar emptyValue = {\r\n\t\tstarttime: 0,\r\n\t\tendtime: 0\r\n\t};\r\n\r\n\tangular.module('my.directives.dateFilter', ['my.directives.datepicker'])\r\n\r\n\t\t.directive('myDateFilter', function() {\r\n\r\n\t\t\treturn {\r\n\t\t\t\trequire: ['^myFilter', 'ngModel'],\r\n\t\t\t\trestrict: 'E',\r\n\t\t\t\tscope: {},\r\n\t\t\t\ttemplateUrl: '/directives/dateFilter.html',\r\n\t\t\t\tcontrollerAs: '$ctrl',\r\n\t\t\t\tbindToController: {\r\n\t\t\t\t\tname: '=',\r\n\t\t\t\t\tngModel: '='\r\n\t\t\t\t},\r\n\r\n\t\t\t\tcontroller: ['$scope', 'myExtend', function($scope, myExtend) {\r\n\r\n\t\t\t\t\tvar model = $scope.$ctrl.ngModel;\r\n\t\t\t\t\tvar ctrl = myExtend.subController($scope, 'DateFilterCtrl');\r\n\r\n\t\t\t\t\tangular.extend(ctrl, {\r\n\r\n\t\t\t\t\t\treset: function () {\r\n\t\t\t\t\t\t\tangular.extend(model, emptyValue);\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tdefaultOrEmpty: function() {\r\n\t\t\t\t\t\t\treturn ctrl.isEmpty(); // default value not supported\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tdisplayString: function() {\r\n\r\n\t\t\t\t\t\t\tif (ctrl.isEmpty()) {\r\n\t\t\t\t\t\t\t\treturn '';\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (ctrl.selectionModel == 'custom') {\r\n\t\t\t\t\t\t\t\treturn (labels[ctrl.selectionModel] + ' : ' + ctrl.date + ' - ' + ctrl.customEndDate);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn (labels[ctrl.selectionModel] + ' : ' + ctrl.date);\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t\t{value: 'before', label: labels.before},\r\n\t\t\t\t\t\t\t{value: 'after', label: labels.after},\r\n\t\t\t\t\t\t\t{value: 'on', label: labels.on},\r\n\t\t\t\t\t\t\t{value: 'custom', label: labels.custom}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$scope.$watchCollection(function() {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tdate: ctrl.date,\r\n\t\t\t\t\t\t\tcustomEndDate: ctrl.customEndDate,\r\n\t\t\t\t\t\t\tselectionModel: ctrl.selectionModel\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}, function(vals, oldVals) {\r\n\r\n\t\t\t\t\t\tif (angular.equals(vals, oldVals)) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!ctrl.date || (ctrl.selectionModel == 'custom' && (!ctrl.customEndDate || (moment(ctrl.date) >= moment(ctrl.customEndDate))))) {\r\n\t\t\t\t\t\t\tctrl.reset();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tswitch (ctrl.selectionModel) {\r\n\r\n\t\t\t\t\t\t\tcase 'before':\r\n\t\t\t\t\t\t\t\tmodel.starttime = 1;\r\n\t\t\t\t\t\t\t\tmodel.endtime = moment(ctrl.date).startOf(\"day\").unix() - 1;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'after':\r\n\t\t\t\t\t\t\t\tmodel.starttime = moment(ctrl.date).endOf(\"day\").unix() + 1;\r\n\t\t\t\t\t\t\t\tmodel.endtime = moment().endOf(\"day\").unix();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'on':\r\n\t\t\t\t\t\t\t\tmodel.starttime = moment(ctrl.date).startOf(\"day\").unix();\r\n\t\t\t\t\t\t\t\tmodel.endtime = moment(ctrl.date).endOf(\"day\").unix();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'custom':\r\n\t\t\t\t\t\t\t\tmodel.starttime = moment(ctrl.date).startOf(\"day\").unix();\r\n\t\t\t\t\t\t\t\tmodel.endtime = moment(ctrl.customEndDate).endOf(\"day\").unix();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$scope.$watchCollection(function() {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tstarttime: model.starttime,\r\n\t\t\t\t\t\t\tendtime: model.endtime\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}, function() {\r\n\r\n\t\t\t\t\t\tif (!model.starttime || !model.endtime) {\r\n\t\t\t\t\t\t\tctrl.date = '';\r\n\t\t\t\t\t\t\tctrl.customEndDate = '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}],\r\n\r\n\t\t\t\tlink: function ($scope, $element, $attrs, ctrls) {\r\n\r\n\t\t\t\t\tvar ctrl = $scope.$ctrl = $scope.$ctrl.ngModel.$ctrl;\r\n\r\n\t\t\t\t\tvar filterCtrl = ctrls[0];\r\n\t\t\t\t\tfilterCtrl.addFilterComponent(ctrl.name, ctrl);\r\n\r\n\t\t\t\t\tangular.extend(ctrl, {\r\n\r\n\t\t\t\t\t\tgetDatepickerId: function (modelName) {\r\n\r\n\t\t\t\t\t\t\t// the jQuery datepicker widget creates dynamic IDs\r\n\t\t\t\t\t\t\treturn $element.find(\"[ng-model='$ctrl.\" + modelName + \"']\")[0].id;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\t.controller('DateFilterCtrl', ['$scope', '$filter', 'myExtend', function($scope, $filter, myExtend) {\r\n\r\n\t\t\tvar model = $scope.$ctrl.ngModel;\r\n\t\t\tvar ctrl = myExtend.subController($scope);\r\n\r\n\t\t\tif (!('starttime' in model)) { // init\r\n\r\n\t\t\t\tangular.extend(model, emptyValue);\r\n\t\t\t}\r\n\r\n\t\t\tangular.extend(ctrl, {\r\n\r\n\t\t\t\tdate: '',\r\n\t\t\t\tcustomEndDate: '',\r\n\t\t\t\tselectionModel: 'before',\r\n\r\n\t\t\t\tisEmpty: function () {\r\n\t\t\t\t\treturn ((model.starttime == 0) && (model.endtime == 0));\r\n\t\t\t\t},\r\n\r\n\t\t\t\tqueryString: function() {\r\n\t\t\t\t\tif (!ctrl.isEmpty()) {\r\n\t\t\t\t\t\treturn \"((\" + ctrl.name + \".starttime eq \" + model.starttime + \") and (\" + ctrl.name + \".endtime eq \" + model.endtime + \"))\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\r\n\t\t\tif (ctrl.isEmpty()) {\r\n\t\t\t\treturn ctrl;\r\n\t\t\t}\r\n\r\n\t\t\tvar dateFilter = $filter('date');\r\n\r\n\t\t\tif (model.starttime == 1) {\r\n\t\t\t\tctrl.selectionModel = 'before';\r\n\t\t\t\tctrl.date = dateFilter((model.endtime+1)*1000, 'MM/dd/yyyy');\r\n\t\t\t}\r\n\t\t\telse if (model.starttime % 2) {\r\n\t\t\t\tctrl.selectionModel = 'after';\r\n\t\t\t\tctrl.date = dateFilter((model.starttime-1)*1000, 'MM/dd/yyyy');\r\n\t\t\t}\r\n\t\t\telse if ((model.endtime - model.starttime + 1) == 86400) {\r\n\t\t\t\tctrl.selectionModel = 'on';\r\n\t\t\t\tctrl.date = dateFilter(model.starttime*1000, 'MM/dd/yyyy');\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tctrl.selectionModel = 'custom';\r\n\t\t\t\tctrl.date = dateFilter(model.starttime*1000, 'MM/dd/yyyy');\r\n\t\t\t\tctrl.customEndDate = dateFilter(model.endtime*1000, 'MM/dd/yyyy');\r\n\t\t\t}\r\n\r\n\t\t\treturn ctrl;\r\n\t\t}]);\r\n\r\n___\r\n# (Oct 2015) Leveraging the '$' prefixed variable hiding in AngularJS\r\n\r\n### Did you know?\r\nA \"feature\" of AngularJS is in hiding variables that have names beginning with '$'. These variables are ignored during watches, and that makes them useful for hiding your own information. Knowing this, one can set up a data model with the definition of the data in a '$def' variable. So running a watch on the data model will work as normal (and ignore changes in the $def variable). This enables easy augmentation of existing simple models to be more complex.\r\n\r\n### Filters example\r\nSimple model:\r\n\r\n\tvar model = {\r\n\t\tproduct: 'analytics',\r\n\t\tview: 'report',\r\n\t\tsort: 'date',\r\n\t\tsearchText: 'abc'\r\n\t};\r\n\r\nComplex model:\r\n\r\n\tvar model = {\r\n\t\tproduct: 'analytics',\r\n\t\tview: ['report'],\r\n\t\tsort: ['date','name'],\r\n\t\tsearchText: 'abc',\r\n\t\tdate: {\r\n\t\t\tstarttime: 123,\r\n\t\t\tendtime: 1234\r\n\t\t},\r\n\t\t$def: {\r\n\t\t\toptions: {\r\n\t\t\t\tproduct: {\r\n\t\t\t\t\tindex: 0,\r\n\t\t\t\t\tlabel: 'Product',\r\n\t\t\t\t\ttype: 'text'\r\n\t\t\t\t},\r\n\t\t\t\tview: {\r\n\t\t\t\t\tindex: 1,\r\n\t\t\t\t\tlabel: 'View',\r\n\t\t\t\t\ttype: 'ListFilterCtrl',\r\n\t\t\t\t\t$def: {\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\treport: { index: 0, label: 'Report' },\r\n\t\t\t\t\t\t\tdetail: { index: 1, label: 'Detail' }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsort: {\r\n\t\t\t\t\tindex: 2,\r\n\t\t\t\t\tlabel: 'Sort By',\r\n\t\t\t\t\ttype: 'ListFilterCtrl',\r\n\t\t\t\t\t$def: {\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tdate: { index: 0, label: 'Date' },\r\n\t\t\t\t\t\t\tname: { index: 1, label: 'Name' }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsearchText: {\r\n\t\t\t\t\tindex: 3,\r\n\t\t\t\t\tlabel: 'Search Text',\r\n\t\t\t\t\ttype: 'text'\r\n\t\t\t\t},\r\n\t\t\t\tdate: {\r\n\t\t\t\t\tindex: 4,\r\n\t\t\t\t\tlabel: 'Date',\r\n\t\t\t\t\ttype: DateFilterCtrl\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n___\r\n# (Sep 2015) Inheritance patterns in Angular 1.4 (from scouring the web)\r\n\r\n### Controllers\r\nUsing inheritance and/or mixins:\r\n\r\n\tangular.module('my.services', []).factory('myClass', function() {\r\n\t\r\n\t\tvar BaseController = function() {\r\n\t\r\n\t\t\tthis.modelDef = null;\r\n\t\t};\r\n\t\tBaseController.prototype.setupModel = function() {\r\n\t\r\n\t\t\tvar process = function(modelDef) {\r\n\t\t\t\t// process modelDef into model\r\n\t\t\t};\r\n\t\t\tthis.model = process(this.modelDef);\r\n\t\t};\r\n\t\r\n\t\treturn {\r\n\t\t\tBaseController: BaseController\r\n\t\t};\r\n\t});\r\n\t\r\n\tangular.module('my.services', []).factory('myMixin', ['restData', function(restData) {\r\n\t\r\n\t\tvar tabulate = function() {\r\n\t\t\t// tabulate the list-type models from this.modelDefs\r\n\t\t};\r\n\t\r\n\t\tvar restify = function() {\r\n\t\t\t// call back-end services via restData service\r\n\t\t};\r\n\t\r\n\t\t// no prototype functions\r\n\t\treturn {\r\n\t\t\ttabulate: tabulate,\r\n\t\t\trestify: restify\r\n\t\t};\r\n\t}]);\r\n\t\r\n\tangular.module('my.directives', ['my.services'])\r\n\t\t.directive('myReport', ['myClass', function(myClass) {\r\n\t\r\n\t\t\tvar SubController = function($filter, myMixin) {\r\n\t\r\n\t\t\t\tmyClass.BaseController.apply(this);\r\n\t\r\n\t\t\t\tangular.extend(this, myMixin); // mix in to controller instance\r\n\t\r\n\t\t\t\tthis.modelDef = {\r\n\t\t\t\t\t// set of model definitions\r\n\t\t\t\t};\r\n\t\t\t\tthis.setupModel();\r\n\t\t\t};\r\n\t\t\tSubController.prototype = Object.create(myClass.BaseController.prototype);\r\n\t\t\tSubController.$inject = ['$filter', 'myMixin'];\r\n\t\r\n\t\t\treturn {\r\n\t\t\t\tscope: {\r\n\t\t\t\t\t// scope props\r\n\t\t\t\t},\r\n\t\t\t\ttemplateUrl: '/path/file.html',\r\n\t\r\n\t\t\t\tcontroller: SubController,\r\n\t\t\t\tcontrollerAs: 'ctrl',\r\n\t\t\t\tbindToController: true,\r\n\t\r\n\t\t\t\tlink: function ($scope, $element, $attrs) {\r\n\t\t\t\t\t// do things\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}]);\r\n\r\nDecorator pattern:\r\n\r\n\tangular.module('my', ['my.services'])\r\n\t\t.decorator('$controller', ['myMixin', '$delegate', function (myMixin, $delegate) {\r\n\t\r\n\t\t\treturn function (constructor, locals) {\r\n\t\r\n\t\t\t\tvar controller = $delegate.apply(null, arguments);\r\n\t\r\n\t\t\t\treturn angular.extend(function () {\r\n\t\r\n\t\t\t\t\treturn angular.extend(controller(), myMixin); // mix in to controller instances\r\n\t\r\n\t\t\t\t\t// one can also do things based on the type of 'constructor'\r\n\t\r\n\t\t\t\t}, controller);\r\n\t\t\t};\r\n\t\t}]);\r\n\r\n### Services\r\nUsing inheritance:\r\n\r\n\tangular.module('my.services', []).factory('mySubClass', ['myClass', function() {\r\n\t\r\n\t\tvar SubController = function($filter) {\r\n\t\r\n\t\t\tmyClass.BaseController.apply(this);\r\n\t\r\n\t\t\tthis.modelDef = {\r\n\t\t\t\t// set of model definitions\r\n\t\t\t};\r\n\t\t\tthis.setupModel();\r\n\t\t};\r\n\t\tSubController.prototype = Object.create(myClass.BaseController.prototype);\r\n\t\r\n\t\treturn {\r\n\t\t\tSubController: SubController\r\n\t\t};\r\n\t}]);\r\n\r\nDecorator pattern:\r\n\r\n\tangular.module('my', [])\r\n\t\t.decorator('myService', function ($delegate) {\r\n\t\r\n\t\t\treturn function() {\r\n\t\t\t\t// do things\r\n\t\t\t\treturn $delegate();\r\n\t\t\t}\r\n\t\t});\r\n\r\n### Directives\r\n* Using inheritance and/or mixins: By inheriting directive controllers as opposed to directives: see myReport directive above.\r\n* Using the 'require' parameter in the directive definition, for directive controller dependencies.\r\n* Directive wrapping: <http://thaiat.github.io/blog/2014/03/10/extending-an-existing-directive-in-angularjs/>\r\n\r\nDecorator pattern:\r\n\r\n\tangular.module('my', [])\r\n\t\t.decorator('myReportDirective', function ($delegate) {\r\n\t\t\t\r\n\t\t\t// do things\r\n\t\t\treturn $delegate;\r\n\t\t});\r\n\r\nNote: There is no $directive service like there is $controller (above), so you can't blanket all directives that way.\r\n\r\n### Best Practice\r\nThe new $controller service (in 1.4) looks promising for inheritance purposes, when used outside of Angular's testing framework.\r\n\r\n___\r\n# (Dec 2014) Inheritance patterns in JavaScript (and some Python)\r\n\r\n### SubClassing\r\n* Traditional\r\n* Computer Sciencey\r\n* ES6 'class' keyword\r\n* used below as \"inheritance\"\r\n* Example: Dogs and Cats are Animals. Dogs cannot meow(). Cats cannot bark().\r\n\r\n\t\tvar Animal = function(){};\r\n\t\tAnimal.prototype = { walk: function(){} };\r\n\t\t\r\n\t\tvar Dog = function(){};\r\n\t\tDog.prototype = Object.create(Animal.prototype);\r\n\t\tDog.prototype.bark = function(){};\r\n\t\t\r\n\t\tvar Cat = function(){};\r\n\t\tCat.prototype = Object.create(Animal.prototype);\r\n\t\tCat.prototype.meow = function(){};\r\n\t\t\r\n\t\tvar dog = new Dog;\r\n\t\tvar cat = new Cat;\r\n\t\t\r\n\t\tdog instanceof Animal; // true\r\n\t\tdog instanceof Dog; // true\r\n\t\tdog instanceof Cat; // false\r\n\t\t\r\n\t\tdog.bark; // defined\r\n\t\tdog.meow; // not defined\r\n\r\n### SubInstancing\r\n* \"Dynamic SubClassing\"\r\n* JQuery $.extend()\r\n* ES6 Object.assign(), copying traits over\r\n* used below as \"mixin\"\r\n* Example: Animals can be Dogs or Cats, given their traits of bark() and meow().\r\n\r\n\t\t// from example above\r\n\t\tdog.meow = cat.meow;\r\n\t\tdog.meow; // Now defined. But conflicts with instanceof operator result of Cat.\r\n\t\t\r\n\t\t// use of mixins\r\n\t\tvar dogMixin = { bark: function(){} };\r\n\t\tvar catMixin = { meow: function(){} };\r\n\t\t\r\n\t\tvar animal = { walk: function(){} };\r\n\t\tvar dog = $.extend({}, animal, dogMixin);\r\n\t\tvar cat = $.extend({}, animal, catMixin);\r\n\t\t\r\n\t\tdog.bark; // defined\r\n\t\tdog.meow; // not defined\r\n\t\t\r\n\t\t// The instanceof operator can't be used. Instead, error out or use duck-typing.\r\n\r\n### JavaScript Inheritance\r\n* Everything's derived from Object, including Class and Instance\r\n* Allows for SubInstances in addition to SubClasses\r\n* Multiple inheritance by mixins, i.e. copy multiple traits over: works due to the two points above\r\n\r\n### Python Inheritance (I'm not an expert)\r\n* Class is separate from Instance\r\n* Does not allow for SubInstances\r\n* Multiple inheritance (for Class) is built into syntax\r\n\r\n### When Inheritance breaks down\r\n* Deep inheritance hierarchies that create rigid dependencies that are very difficult to break when requirements change\r\n* JavaScript's SubInstance flexibility may alleviate rigidity by providing crutches while the hierarchies are reworked, but this needs to be short-term only\r\n* In Python, maybe preplan for retiring old things and starting anew\r\n\r\n### Best Practice\r\n* For scalability reasons, and the aforementioned breaking down: build shallow and wide, instead of deep and narrow. Favor composition over inheritance to do that.\r\n\r\n___\r\n![funny](http://raviolibhat.github.io/SantaPoitras1.jpg)\r\n# (Dec 2013) Easy URL Hash Routing with AngularJS\r\n\r\n### Goals\r\n* URL Hash Routing Service\r\n* Drive web application state from the URL\r\n\r\n### Why?\r\n* Browsing within a Single Page Application\r\n* Supporting browser back, forward, refresh buttons\r\n* Bookmarking and linking from other pages\r\n\r\n### When?\r\n2013, supporting older Internet Exploder versions\r\n\r\n### What?\r\nExisting options at the time:\r\n* ngRoute module\r\n* External ui-router package\r\n* Leveraging $location (the winner)\r\n* Vanilla JavaScript, non-Angular\r\n\r\n### How?\r\nSupporting older browsers means no HTML5 History API...\r\n\r\nBasic URL format:\r\n\r\n`http://host/path#?param1=value1&param2=value2&paramN=valueN`\r\n\r\nExamples:\r\n* `?product=analytics`\r\n* `?product=analytics&view=report`\r\n* `?product=analytics&view=report&sort=date`\r\n* `?product=analytics&view=detail`\r\n* `?product=finance&view=detail`\r\n* `?product=finance&view=detail&filter=abc`\r\n\r\nEntities:\r\n* Location model: contains the name/value pairs\r\n* Root scope: contains the Location model\r\n* Location service: Built on $location, exposes a register() API\r\n* Child scopes\r\n\r\nComponents (directives) that use browser navigation, define URL parameters by using the Location service's register().\r\nAll bindings to such parameters by any component are done on the Location model.\r\nExample actions:\r\n* Switch views based on URL parameter 'view': ng-switch on $root.locationModel.view, target 'report' vs 'detail' etc.\r\n\r\n\t\t<div ng-switch=\"$root.locationModel.view\">\r\n\t\t\t<overview ng-switch-when=\"overview\"></overview>\r\n\t\t\t<report ng-switch-when=\"report\"></report>\r\n\t\t\t<detail ng-switch-when=\"detail\"></detail>\r\n\t\t</div>\r\n\r\n* Set sort column indication on a detail table: ng-class on $root.locationModel.sort\r\n\r\n\t\t<div ng-class=\"{'sorted-col': col==$root.locationModel.sort}\"></div>\r\n\r\n* More complex actions: $watch a subset of parameters in $root.locationModel\r\n\r\n\t\t$scope.$watch(\r\n\t\t\tfunction() {\r\n\t\t\t\tvar locationModel = angular.copy($rootScope.locationModel);\r\n\t\t\t\tdelete locationModel.filter;\r\n\t\t\t\tdelete locationModel.sort;\r\n\r\n\t\t\t\treturn locationModel;\r\n\t\t\t},\r\n\t\t\tfunction() {\r\n\t\t\t\t// do things independent of a filter or sorting change\r\n\t\t\t},\r\n\t\t\ttrue\r\n\t\t);\r\n\r\nWhen components are destroyed, any parameters they defined are removed from locationModel automatically.\r\nURL parameters with default values, set with register(), are hidden from the URL.\r\n\r\nCode:\r\n\r\n\t// used to provide browser history support: two-way binds the location params with a model\r\n\tangular.module('my.services', []).factory('myLocation', ['$rootScope', '$location', function($rootScope, $location) {\r\n\r\n\t\tvar locationModel = {};\r\n\t\t$rootScope.locationModel = locationModel;\r\n\r\n\t\tvar paramDefaults = {};\r\n\r\n\t\tvar updateLocationModel = function() {\r\n\r\n\t\t\tvar locationParams = $location.search();\r\n\r\n\t\t\t// take location params and update the model, setting defaults as needed\r\n\t\t\tfor (var param in paramDefaults) {\r\n\r\n\t\t\t\tif (param in locationParams) {\r\n\t\t\t\t\tif (typeof paramDefaults[param] == \"number\") {\r\n\t\t\t\t\t\tlocationModel[param] = parseInt(locationParams[param]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlocationModel[param] = locationParams[param];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlocationModel[param] = paramDefaults[param];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// copy any remaining non-default location params\r\n\t\t\tfor (var param in locationParams) {\r\n\r\n\t\t\t\tif (!(param in paramDefaults)) {\r\n\t\t\t\t\tlocationModel[param] = locationParams[param];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar updateLocationSearch = function() {\r\n\r\n\t\t\tvar replaceLocation = true;\r\n\t\t\tvar oldLocationParams = $location.search();\r\n\t\t\tvar locationParams = {};\r\n\r\n\t\t\t// only include non-default parameters in location.search\r\n\t\t\tfor (var param in paramDefaults) {\r\n\r\n\t\t\t\tif (locationModel[param] != paramDefaults[param]) {\r\n\t\t\t\t\tlocationParams[param] = locationModel[param];\r\n\r\n\t\t\t\t\tif (locationParams[param] != oldLocationParams[param]) {\r\n\t\t\t\t\t\treplaceLocation = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// also include any remaining params\r\n\t\t\tfor (var param in locationModel) {\r\n\r\n\t\t\t\tif (!(param in paramDefaults)) {\r\n\t\t\t\t\tlocationParams[param] = locationModel[param];\r\n\r\n\t\t\t\t\tif (locationParams[param] != oldLocationParams[param]) {\r\n\t\t\t\t\t\treplaceLocation = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (Object.keys(locationParams).length == 0) {\r\n\t\t\t\t// prevent an infinite digest (see Angular issues 9635 and 10228)\r\n\t\t\t\t// ...remove after Angular upgrade fixes bug.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (replaceLocation) {\r\n\t\t\t\t$location.replace();\r\n\t\t\t}\r\n\r\n\t\t\t$location.search(locationParams);\r\n\t\t};\r\n\r\n\t\tvar registrations = 0;\r\n\t\tvar deregistrationToFunction = null;\r\n\t\tvar deregistrationFroFunction = null;\r\n\r\n\t\treturn {\r\n\r\n\t\t\tregister: function($scope, scopeParamDefaults) {\r\n\r\n\t\t\t\tangular.extend(paramDefaults, scopeParamDefaults);\r\n\r\n\t\t\t\tupdateLocationModel();\r\n\r\n\t\t\t\tif (registrations == 0) {\r\n\t\t\t\t\t// bind location.search params to model\r\n\t\t\t\t\tderegistrationToFunction = $rootScope.$on('$locationChangeStart', updateLocationModel);\r\n\r\n\t\t\t\t\t// bind model to location.search params\r\n\t\t\t\t\tderegistrationFroFunction = $rootScope.$watchCollection(\"locationModel\", updateLocationSearch);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tregistrations++;\r\n\r\n\t\t\t\t$scope.$on(\"$destroy\", function() {\r\n\r\n\t\t\t\t\tfor (var param in scopeParamDefaults) {\r\n\t\t\t\t\t\tdelete locationModel[param];\r\n\t\t\t\t\t\tdelete paramDefaults[param];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tregistrations--;\r\n\r\n\t\t\t\t\tif (registrations == 0) {\r\n\t\t\t\t\t\tderegistrationToFunction();\r\n\t\t\t\t\t\tderegistrationFroFunction();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t}])\r\n\r\nContracts:\r\n* Child components should not define the same parameter names as a parent. If needed, use namespaces.\r\n* Order of parameters is the order of register() invocations, but not guaranteed. This means navigation within an app generally has good order. But if a bookmark link is navigated to, the order of parameters may change upon navigation, though it won't add an extra navigation.\r\n\r\n### Derived Goals\r\n* Easy to learn and use, both internally (engineering) and externally (marketing)\r\n\r\n### Derived Ungoals\r\n* Internal application (non-URL) routing\r\n* Parameter collision\r\n* Complexity\r\n\r\n### Best Practice\r\n* Angular 1 allows you to create a standalone controller without a directive. This is especially notable when using the ngRoute module. For scalability reasons, and planning for Angular 2: All controllers should be in directives. This also enables use of the above easy routing and watchers, instead of ngView and ngRoute promises.\r\n\r\n___\r\n# (Jan 2013) Fiddle Fingers\r\n\r\n### History\r\n* Invented by me in 2002\r\n* Result of an internal contest at Xilinx, a semiconductor company\r\n\r\n### Inputs\r\n* 4 finger-buttons\r\n* 1 reset\r\n* 1 on-board 555 clock\r\n\r\n### Outputs\r\n* 4 level-LEDs\r\n* 4 value-LEDs\r\n* 1 7-segment score display\r\n\r\n### Description\r\nFiddle Fingers is designed to be used in child development centers, handicapped rehabilitation centers or simply as a toy for all ages. It is a game that tests finger-eye reflex coordination. The game consists of four buttons that the player places their four fingers on, which excludes the thumb.  When the game is started, one LED in four, lights up.  The player then depresses\r\nthe finger that corresponds to the LED.  Then, the lit LED turns off and another one lights up. The player has to then depress that LED button and no other finger.  This process is repeated and gets faster and faster.\r\n\r\nThe aim is to be quick at pressing the button corresponding to the LED that is on.  This tests the player's eye-finger reflex speed.  It is a good tool to improve the coordination of misfortunate disabled people who suffer with respect to hand-eye coordination.\r\n\r\nA display of four LEDs shows the player what level they have achieved.  There are five LEDs. The game starts with none of the four LEDs lit up, hence level 0.  Then 1 lights up as the speed increases, then another and so on till all four are lit up.  Once this level is completed the game stops. It should be very difficult if not impossible to get to this stage.\r\n\r\nAnother display which is a 7-segment display shows the player's current score.  This is a count of how many LED presses the player has missed.  When this reaches six the game ends. Hence, the best player has the least score, and the highest level.\r\n\r\nPossible future modifications are increasing the score limit, cycling through the levels to attain more levels, changing the initial start speed of the game etc.\r\n\r\n### Patent Application\r\n[figs](http://raviolibhat.github.io/patent_figs.pdf)","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}